# Mosquito Sound Samples Detection – Code Repository

This repository contains the **code accompanying our research paper** on the detection of mosquito sound chunks from various audio recordings.

The repository is divided into two main parts:
1.  **`detectors/1_heuristic`**: Heuristic-based scripts used to process raw field and lab recordings (from ABUZZ, Setup-1, and Setup-2) and extract potential 1-second mosquito and non-mosquito sound samples.
2.  **`detectors/2_dnn/`**: Scripts for training and running Deep Neural Network (DNN) models, using the samples generated by the heuristic detectors.

---

## Repository Structure

```

.
├── detectors/
│   └── 1\_heuristic/
│       ├── ABUZZ/
│       │   └── README.md         (1. Heuristic Detector for ABUZZ data)
│       ├── Setup\_1/
│       │   └── README.md         (2. Heuristic Detector for Setup-1 data)
│       └── Setup\_2/
│           └── README.md         (3. Heuristic Detector for Setup-2 data)
└── 2\_dnn/
        ├── 1\_training/
        ├── 2\_inference/
        └── README.md                 (4. DNN Training and Inference)

```

---

## 1. Heuristic Detectors (`detectors/1_heuristic/`)

This directory contains the first-stage processing scripts. Their primary goal is to **create an initial dataset** of 1-second audio chunks (`.wav` files) by scanning long raw recordings. These scripts filter out silence and speech (using Silero VAD) and apply different heuristics to identify segments with mosquito-like sounds.

These scripts produce the "positive" (`mosquito`) and "negative" (`not_selected`) samples that are used as input for the DNN training pipeline.

### 1.1. ABUZZ (`.../ABUZZ/`)

* **Data:** Processes the ABUZZ dataset (mixed audio formats).
* **Method:** Uses a spectral heuristic that looks for a strong tonal peak (wing-beat fundamental frequency) and a significant dB drop after the peak.
* **Details:** See **`detectors/1_heuristic/ABUZZ/README.md`**

### 1.2. Setup-1 (`.../Setup_1/`)

* **Data:** Processes 2-channel recordings from our custom "Setup-1".
* **Method:** Uses a similar spectral peak-drop heuristic but introduces a crucial **noise subtraction** step, where a pre-computed noise profile for the recording device is removed from the spectrogram before analysis.
* **Details:** See **`detectors/1_heuristic/Setup_1/README.md`**

### 1.3. Setup-2 (`.../Setup_2/`)

* **Data:** Processes 4-channel recordings from our custom "Setup-2".
* **Method:** This script does *not* use noise profiles. It uses a different heuristic that checks if the segment's amplitude is within a specific range (filtering out silence and loud pops) in addition to the spectral peak analysis.
* **Details:** See **`detectors/1_heuristic/Setup_2/README.md`**

---

## 2. DNN Training and Inference (`detectors/2_dnn/`)

This directory contains the complete pipeline for training and using deep learning models on the data generated by the heuristic detectors.

The full workflow is documented in **`2_dnn/README.md`**.

### 2.1. Data Preparation & Training (`2_dnn/1_training/`)

This stage involves:
1.  **Collecting Data:** Gathering all `mosquito` and `not` samples from the heuristic detectors.
2.  **Splitting Data:** Using `b_mosquito_create_train_valid_sets_en.ipynb` to create `train` and `validation` sets. This script ensures no data leakage by splitting based on the original file prefix, not randomly.
3.  **Training Models:**
    * **ResNet + Self-Attention:** A custom ResNet-18 model (`b_mosquito_train_simple_classifier.ipynb`).
    * **Audio Spectrogram Transformer (AST):** A fine-tuned AST model from Hugging Face (`train_huggingface_AST_b_mosquito_25_01_21.ipynb`).

### 2.2. Inference (`2_dnn/2_inference/`)

This stage provides scripts to run the trained models on new data:
* **ResNet Inference:** `detect_mosquito_sounds_simple_classifier.ipynb`
* **AST Inference:** `detect_mosquito_sounds_AST.ipynb`
* **Combined Filtering:** `combine_resnet_and_AST_detections.ipynb` (A script to create a high-precision dataset by keeping only detections agreed upon by both models).
